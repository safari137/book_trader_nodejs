<% include ../partials/header.ejs %>

<div class="container">
    <a href="/newbook">Add Book</a>
    <div class="bordered top">
        <h2>My Books <span class="open-close">-</span></h2>
        <div class='row collapsible'>
        <% if (books) { books.forEach(function(book) { %>
            <div class='book col-md-2 col-sm-4'>
                <div class="thumbnail">
                    <img src='<%= book.imageUrl %>'>
                    <div class='caption text-center'>
                         <div class='delete text-center' id='<%= book._id %>'><i class="fa fa-trash-o"></i></div>
                     </div>
                </div>
            </div>
        <% }) } %>
        </div>
    </div>
    
    <div class="bordered top">
        <h2>Requests Sent <span class="open-close">-</span></h2> 
        
        <div class="row collapsible">
            <% if (requestedBooks) { requestedBooks.forEach(function(request) { %>
                <div class='book col-md-2 col-sm-4'>
                    <div class="thumbnail">
                        <img src='<%= request.book.imageUrl %>'>
                        <button class="btn btn-danger btn-block cancelRequest" id='<%= request.book._id %>'>Cancel</button>
                    </div>
                </div>
            <% })} %>
        </div>
    </div>
    
    <div class="bordered top">
        <h2>Requests Received <span class="open-close">-</span></h2>
            <div class="row collapsible">
            <% if (requestsReceived) { requestsReceived.forEach(function(request) { %>
                <div class='book col-md-2 col-sm-4'>
                    <div class="thumbnail">
                        <img src='<%= request.book.imageUrl %>'>
                        <button class="btn btn-danger btn-block cancelRequest" id='<%= request.book._id %>'>Cancel</button>
                        <a href="/user/<%=request.requesterId%>/books" class="btn btn-success btn-block">User's Books</a>
                    </div>
                </div>
            <% })} %>
        </div>
    </div>
    
    <div class="bordered top">
        <h2>Borrowed Books <span class="open-close">-</span></h2>
        <div class="row collapsible">
            <% if (borrowedBooks) { borrowedBooks.forEach(function(book) { %>
                <div class='book col-md-2 col-sm-4'>
                    <div class="thumbnail">
                        <img src='<%= book.imageUrl %>'>
                        <hr>
                        <button class="btn btn-block btn-success returnBook" id="<%= book._id %>">Return Book</button>
                    </div>
                </div>
            
            <% })} %>
        </div>
    </div>
    
    <div class="bordered top">
        <h2>Trades Ready <span class="open-close">-</span></h2>
        <div class="row collapsible">
            <% if (trades) { trades.forEach(function(trade) { %>
                <div class='col-sm-6 text-center trade-group'>
                    <div class="col-sm-6">
                        <img class='min' src='<%= trade.usersBook.imageUrl %>' alt='<%= trade.usersBook.title %>'>
                    </div>
                    <div class='col-sm-6'>
                        <img class='min' src='<%= trade.bookReceived.imageUrl %>' alt='<%= trade.bookReceived.title %>'>
                    </div>
                    <div class='col-sm-12 trade text-center'>
                        <a href='/api/trade/?bookGiven=<%= trade.usersBook._id %>&bookReceived=<%= trade.bookReceived._id %>' class='btn btn-success btn-block'>Make Trade</a>
                    </div>
                </div>
            <% })} %>
        </div>
    </div>
    
</div>

<script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="./js/mybooks.js"></script>

<% include ../partials/footer.ejs %>